<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Voice Clone</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            --bg-dark: #313338;
            --bg-sidebar: #2b2d31;
            --bg-user: #232428;
            --text-main: #dbdee1;
            --text-muted: #949ba4;
            --brand: #5865f2;
            --danger: #f23f42;
            --success: #23a559;
        }

        body {
            font-family: 'gg sans', 'Noto Sans', sans-serif;
            background-color: var(--bg-sidebar);
            color: var(--text-main);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            -webkit-user-select: none;
            user-select: none;
        }

        /* Sidebar Style */
        .sidebar {
            width: 240px;
            background-color: var(--bg-sidebar);
            display: flex;
            flex-direction: column;
        }

        .main-content {
            flex: 1;
            background-color: var(--bg-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Voice State UI */
        .voice-container {
            text-align: center;
        }

        .avatar-large {
            width: 120px;
            height: 120px;
            background: #5865f2;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            color: white;
            box-shadow: 0 0 0 0px var(--brand);
            transition: box-shadow 0.2s;
        }

        .speaking {
            box-shadow: 0 0 0 4px var(--success);
        }

        .status-text {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .id-badge {
            background: rgba(0,0,0,0.3);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            color: var(--text-muted);
            cursor: pointer;
        }

        /* Bottom User Panel (Discord Style) */
        .user-panel {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 52px;
            background-color: var(--bg-user);
            display: flex;
            align-items: center;
            padding: 0 8px;
            box-sizing: border-box;
        }

        .user-info {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 0;
        }

        .avatar-small {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #5865f2;
            margin-right: 8px;
        }

        .username {
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .action-buttons {
            display: flex;
            gap: 4px;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .icon-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .icon-btn.active {
            color: var(--danger);
        }

        /* Call Controls Pop-up */
        .call-controls {
            margin-top: 40px;
            display: flex;
            gap: 16px;
        }

        .control-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: 0.2s;
        }

        .join-btn { background-color: var(--brand); color: white; }
        .join-btn:hover { background-color: #4752c4; }
        .hangup-btn { background-color: var(--danger); color: white; display: none; }
        .hangup-btn:hover { background-color: #a12d2f; }

        input {
            background: #1e1f22;
            border: none;
            color: white;
            padding: 12px;
            border-radius: 4px;
            width: 200px;
            margin-bottom: 10px;
            outline: none;
        }

        /* Incoming Overlay */
        #incoming-overlay {
            display: none;
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div style="padding: 12px; font-weight: bold; border-bottom: 1px solid rgba(0,0,0,0.2);">RÃ¶stkanaler</div>
        <div style="padding: 10px 16px; color: var(--text-muted); cursor: pointer;"># AllmÃ¤nt</div>
    </div>

    <div class="main-content">
        <div id="incoming-overlay">
            <div class="avatar-large">?</div>
            <div class="status-text">Inkommande samtal...</div>
            <div class="call-controls" style="margin-top:20px;">
                <button id="answer-btn" class="control-btn" style="background:var(--success)">âœ”</button>
                <button id="decline-btn" class="control-btn" style="background:var(--danger)">âœ–</button>
            </div>
        </div>

        <div class="voice-container">
            <div id="user-avatar" class="avatar-large">D</div>
            <div id="voice-status" class="status-text">Inte ansluten</div>
            <input type="text" id="remote-id" placeholder="Klistra in vÃ¤nnens ID">
            <div id="display-id" class="id-badge">HÃ¤mtar ditt ID...</div>
            
            <div class="call-controls">
                <button id="call-btn" class="control-btn join-btn">ðŸ“ž</button>
                <button id="hangup-btn" class="control-btn hangup-btn">ðŸ“ž</button>
            </div>
        </div>

        <div class="user-panel">
            <div class="user-info">
                <div class="avatar-small"></div>
                <div class="username">Du (Online)</div>
            </div>
            <div class="action-buttons">
                <div class="icon-btn" id="mute-btn" title="Ljud av">ðŸŽ¤</div>
                <div class="icon-btn" title="InstÃ¤llningar">âš™</div>
            </div>
        </div>
    </div>

    <audio id="remote-audio" autoplay></audio>
    <audio id="sfx-ring" src="https://assets.mixkit.co/active_storage/sfx/1359/1359-preview.mp3" loop></audio>
    <audio id="sfx-join" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3"></audio>

    <script>
        const peer = new Peer();
        let localStream;
        let currentCall;
        let isMuted = false;

        const ringtone = document.getElementById('sfx-ring');
        const joinSfx = document.getElementById('sfx-join');

        // Initiera ID
        peer.on('open', id => {
            document.getElementById('display-id').innerText = "DITT ID: " + id;
        });

        // Svara pÃ¥ samtal
        peer.on('call', call => {
            ringtone.play().catch(()=>{});
            document.getElementById('incoming-overlay').style.display = 'flex';

            document.getElementById('answer-btn').onclick = async () => {
                ringtone.pause();
                document.getElementById('incoming-overlay').style.display = 'none';
                localStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                call.answer(localStream);
                setupCall(call);
            };

            document.getElementById('decline-btn').onclick = () => {
                ringtone.pause();
                document.getElementById('incoming-overlay').style.display = 'none';
                call.close();
            };
        });

        // Starta samtal
        document.getElementById('call-btn').onclick = async () => {
            const id = document.getElementById('remote-id').value;
            if(!id) return alert("Ange ID!");
            
            localStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const call = peer.call(id, localStream);
            setupCall(call);
        };

        function setupCall(call) {
            currentCall = call;
            joinSfx.play();
            document.getElementById('voice-status').innerText = "Ansluten";
            document.getElementById('user-avatar').classList.add('speaking');
            document.getElementById('call-btn').style.display = 'none';
            document.getElementById('hangup-btn').style.display = 'flex';
            document.getElementById('remote-id').style.display = 'none';

            call.on('stream', stream => {
                document.getElementById('remote-audio').srcObject = stream;
            });

            call.on('close', () => location.reload());
        }

        // Mute-funktion
        document.getElementById('mute-btn').onclick = function() {
            if(localStream) {
                isMuted = !isMuted;
                localStream.getAudioTracks()[0].enabled = !isMuted;
                this.classList.toggle('active', isMuted);
                this.innerText = isMuted ? "ðŸ”‡" : "ðŸŽ¤";
            }
        };

        document.getElementById('hangup-btn').onclick = () => location.reload();

        // Kopiera ID
        document.getElementById('display-id').onclick = function() {
            navigator.clipboard.writeText(this.innerText.replace("DITT ID: ", ""));
            alert("ID Kopierat!");
        };
    </script>
</body>
</html>
